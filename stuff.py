import pickle
import matplotlib.pyplot as plt
import numpy as np
from copy import deepcopy
import os

run_ids = [i for i in range(653, 660)]
objs = {'box': ['482',
             '455',
             '1126',
             '770',
             '986',
             '511',
             '770',
             '563*',
             '1065',
             '677',
             '397',
             '711',
             '728',
             '1145',
             '989',
             '88',
             '453',
             '136',
             '1256',
             '290',
             '532',
             '256',
             '709',
             '378',
             '692',
             '230',
             '81',
             '759',
             '1134',
             '1470',
             '915',
             '578',
             '715',
             '27',
             '993',
             '854',
             '228',
             '288',
             '608',
             '14',
             '434',
             '228',
             '595*',
             '177',
             '55',
             '89*',
             '726',
             '801',
             '1051',
             '1364',
             '1097',
             '490',
             '978',
             '1026',
             '146',
             '94',
             '842',
             '219',
             '747',
             '149',
             '627',
             '500',
             '487',
             '782',
             '1000',
             '278',
             '433',
             '41',
             '215',
             '707*',
             '569',
             '94',
             '562',
             '494',
             '650',
             '746',
             '1143',
             '514',
             '149',
             '236*',
             '536',
             '935',
             '994',
             '536',
             '302*',
             '235',
             '282*',
             '278',
             '768',
             '535',
             '798',
             '365*',
             '605',
             '553',
             '730',
             '262',
             '570',
             '1504',
             '19',
             '928',
             '536',
             '1180',
             '44',
             '51*',
             '1527',
             '192',
             '981',
             '1058',
             '157*',
             '299',
             '1098',
             '192',
             '323*',
             '1135*',
             '651',
             '658*',
             '819*',
             '1069',
             '169',
             '343',
             '417',
             '262',
             '180*',
             '816',
             '626',
             '101',
             '1120',
             '647',
             '755',
             '540',
             '41',
             '489',
             '40',
             '647',
             '494',
             '1187',
             '1024',
             '199',
             '517',
             '1036',
             '601',
             '497',
             '433',
             '662',
             '429',
             '650',
             '995',
             '274',
             '526',
             '116',
             '644',
             '86',
             '1016',
             '12',
             '640',
             '848*',
             '674',
             '1110',
             '931',
             '89*',
             '274',
             '134',
             '499',
             '693',
             '1138'],
     'hcylinder': ['440',
                   '615',
                   '135',
                   '196',
                   '524*',
                   '423*',
                   '441',
                   '240',
                   '572',
                   '46',
                   '1016',
                   '709',
                   '685*',
                   '1104',
                   '349',
                   '925',
                   '1075',
                   '582',
                   '523',
                   '456',
                   '1041',
                   '741',
                   '588',
                   '317',
                   '751',
                   '147',
                   '861',
                   '741',
                   '1114',
                   '179',
                   '1279',
                   '837',
                   '538',
                   '802',
                   '692',
                   '24*',
                   '222',
                   '245',
                   '205',
                   '252',
                   '251',
                   '1050',
                   '275',
                   '697',
                   '31',
                   '212',
                   '716',
                   '641*',
                   '694'],
     'sphere': ['586',
                '37',
                '1188',
                '398',
                '1045',
                '311*',
                '426*',
                '373',
                '135',
                '447',
                '1107',
                '426*',
                '75',
                '564',
                '291',
                '402',
                '650',
                '257',
                '456',
                '11*',
                '988*',
                '41',
                '346',
                '473',
                '870',
                '892',
                '439',
                '407',
                '459',
                '1272',
                '1141',
                '642',
                '273',
                '499',
                '238',
                '565',
                '328',
                '667',
                '494',
                '729',
                '567',
                '440',
                '32',
                '577',
                '96',
                '608',
                '186',
                '387*',
                '323',
                '841',
                '812',
                '385',
                '620',
                '1142',
                '647',
                '714',
                '1040',
                '430',
                '889',
                '1230',
                '1103',
                '1447',
                '315',
                '420*',
                '160',
                '301',
                '413',
                '70',
                '471',
                '283*',
                '1065',
                '69*',
                '1024',
                '56',
                '462',
                '288',
                '53',
                '275',
                '1524',
                '900'],
     'vcylinder': ['366*',
                   '140',
                   '277',
                   '1157',
                   '730',
                   '325',
                   '496',
                   '879',
                   '147',
                   '1049',
                   '16',
                   '1095',
                   '115',
                   '195',
                   '122',
                   '502',
                   '331',
                   '982',
                   '1060',
                   '1048',
                   '227',
                   '515',
                   '65',
                   '113',
                   '541',
                   '398',
                   '1083',
                   '446',
                   '198',
                   '1039',
                   '1005',
                   '268',
                   '455',
                   '88',
                   '428',
                   '525',
                   '864',
                   '600',
                   '558',
                   '158',
                   '942',
                   '1048',
                   '1076',
                   '91',
                   '1148',
                   '417',
                   '1023',
                   '706',
                   '1309',
                   '133*',
                   '1320',
                   '1084',
                   '445',
                   '171',
                   '508',
                   '436',
                   '224',
                   '668',
                   '254',
                   '192',
                   '502',
                   '304',
                   '1070',
                   '959',
                   '925',
                   '297',
                   '347',
                   '350',
                   '10',
                   '105*',
                   '471*',
                   '315*',
                   '486',
                   '235',
                   '175',
                   '679',
                   '402',
                   '203',
                   '164',
                   '218',
                   '811',
                   '892',
                   '267',
                   '374',
                   '1330',
                   '747',
                   '633',
                   '713',
                   '29',
                   '5',
                   '782',
                   '201',
                   '547',
                   '515',
                   '246',
                   '46',
                   '625',
                   '30',
                   '485*',
                   '244',
                   '431',
                   '301',
                   '1003',
                   '1015',
                   '1394',
                   '474',
                   '924',
                   '138',
                   '641',
                   '451',
                   '951',
                   '1033',
                   '13',
                   '586',
                   '335',
                   '260',
                   '546',
                   '1155',
                   '29',
                   '685',
                   '654*',
                   '491*',
                   '15',
                   '716',
                   '19',
                   '359',
                   '196',
                   '413',
                   '455',
                   '591',
                   '301',
                   '468',
                   '151',
                   '33',
                   '505',
                   '525',
                   '1082',
                   '280',
                   '375',
                   '1011',
                   '435*',
                   '850',
                   '590',
                   '376',
                   '216',
                   '48',
                   '509',
                   '368',
                   '98',
                   '1001',
                   '867',
                   '122',
                   '681',
                   '277',
                   '1312',
                   '146*',
                   '1051',
                   '187',
                   '668',
                   '257',
                   '1016',
                   '555',
                   '533',
                   '441',
                   '502',
                   '82',
                   '1201',
                   '40',
                   '1147',
                   '138',
                   '480',
                   '276',
                   '919',
                   '230']}
x_scaler = pickle.load(open('/Users/Cem/learning/models/push_before_scaler.pkl', 'rb'))
y_scaler = pickle.load(open('/Users/Cem/learning/models/push_effect_scaler.pkl', 'rb'))
for o, rid in objs.iteritems():
    for r in rid:
        if '*' in r:
            continue
            r = r[:-1]
        for k in run_ids:
            before_csv = '/Volumes/ROSDATA/ros_data/features/new6/%d/push/%s/%s/0.csv' % (k, o, r)
            after_csv = '/Volumes/ROSDATA/ros_data/features/new6/%d/push/%s/%s/1.csv' % (k, o, r)
            if os.path.exists(before_csv):
                before_features = np.genfromtxt(before_csv, delimiter=',')
                after_features = np.genfromtxt(after_csv, delimiter=',')
                break
        if np.array_equal(after_features, np.array([0.0] * 51)):
            print '%s_%s dropped' % (o, r)
            effect_features = deepcopy(before_features)
        else:
            effect_features = np.absolute(np.subtract(after_features, before_features))

        # b = x_scaler.transform(before_features.reshape(1, -1)).flatten()[6:51]
        # e = y_scaler.transform(effect_features.reshape(1, -1)).flatten()[0:3]

        plt.plot([1,2,3], effect_features[0:3], "o")
        plt.xlim([0.5,3.5])
        plt.xticks([0.5,1,2,3,3.5])


plt.legend()
plt.show()
